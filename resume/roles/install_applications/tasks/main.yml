- name: Set environmental variables
  shell: "echo $REDIS_URL"
  environment:
    REDIS_URL: "{{ redis_url }}"

- name: Install pip and redis
  apt:
    name: "{{ item }}"
    state: present
  loop:
    - python3-pip
    - redis-server

- name: Install flask, uwsgi, and gevent
  pip:
    name: "{{ item }}"
    state: present
  loop:
    - flask==3.0.3
    - uWSGI==2.0.31
    - gevent==24.2.1
    - Flask-SSE==1.0.0
    - redis==6.1.1
  notify:
    - Restart flaskapp service